---
title: "01b_PrepIISS_external"
author: "J Andres Gannon, Natalie Seaton, and Christie Marquez"
date: "6/23/2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load essential packages
library(magrittr)
library(ggplot2)
library(data.table)
```

# Prep other datasets to see correlations
## Lyall and Wilson

```{r}
LWdata <- haven::read_dta(file = paste0(here::here(),'/inst/extdata/Lyall-Wilson_IO_2009/Rage_RepData.dta'))

lw <- LWdata %>%
  dplyr::select(yearbg, ccode, vec) %>%
  dplyr::rename(year = yearbg,
                mechvec = vec) %>%
  dplyr::filter(year >= 1970)

```

## Sechser and Saunders
* **Main Battle Tanks**:The Military Balance defines a main battle tank as an armored, tracked combat vehicle with a minimum weight of 16.5 metric tons and a 360 traverse gun whose caliber is at least 75 mm. Examples include the American M-1 Abrams, the Soviet T-80, and the Chinese Type-59 tank.
* **Heavy Armored Combat Vehicle**: Defined as an armored vehicle weighing at least 6 metric tons and containing an organic direct-fire weapon of at least 75 mm. Examples include light tanks such as China’s amphibious Type-63 and Taiwan’s M-41, as well as armored reconnaissance vehicles such as the Israeli RBY and the British-built Ferret.
* **Armored Personnel Carriers and Infantry Fighting Vehicles:** These vehicles are designed to transport infantry squads and are armed with organic cannons of at least 20 mm. Examples include tracked vehicles such as the Bradley Fighting Vehicle and the Soviet-built BMP systems as well as wheeled vehicles like the Chinese WZ551.20.

The data collected by Sechser and Saunders (2010) contains ground mechanization information for all odd-numbered years from 1979–2001.
Using the same sources and procedures, we extended the dataset’s temporal range and collected data for even-numbered years, resulting in a dataset of annual ground mechanization rates for most civil conflict combatants between 1967 and 2003. 16 Note that vehicles belonging to marine or naval infantry units are included in the count of armored vehicles. We follow Sechser and Saunders (2010) in excluding personnel and vehicles belonging to strategic nuclear forces, paramilitary forces, domestic police forces, and reserves from these measurements.

```{r}
SSdata <- readtext::readtext(file = paste0(here::here(),'/inst/extdata/Sechser-Saunders_ISQ_2010/sechser-saunders-ISQ-2010.tab'))

ss <- SSdata %>%
  dplyr::select(year, cabb, mech) %>%
  dplyr::rename(mechvec = mech) %>%
  dplyr::filter(year >= 1970)
```

## Caverley and Sechser
Second, we measure air force mechanization by collecting annual data from The Military Balance on each country’s holdings of combat aircraft. Our measure includes fixed-wing fighters, bombers, and command and control planes, as well as helicopters of all types. The variable aircraft mechanization represents the natural logarithm of a country’s ratio of combat aircraft to soldiers.
```{r}
CSdata <- haven::read_dta(file = paste0(here::here(),'/inst/extdata/Caverley-Sechser_ISQ_2017/Caverley-Sechser-Appendices.dta'))

cs <- CSdata
```

## Crisher and Souva
Load
```{r}
CrSodata <- haven::read_dta(file = paste0(here::here(),'/inst/extdata/Crisher-Souva_II_2014/crisher-souva_navaldata_II.dta'))
```

## Saunders and Souva
Combat aircraft include fighters, attack planes and some combat support planes such as electronic countermeasure aircraft. Combat aircraft do not include transports, tankers or training aircraft.

```{r}
SaSodata <- haven::read_dta(file = paste0(here::here(),'/inst/extdata/Saunders-Souva_CMPS_2019/Country_Air_Power_CY.dta'))
```

# Comparisons
Load our data
```{r}
iiss <- readRDS(file = paste0(here::here(), "/data/01z_rDMC_raw.rds"))

# Comparison Data Table:
# NOTE ** USE @FLEXABLE PACKAGE TO DISTINGUISH THE DIFFERENCES OF THE EQUIPMENT CAPABILITIES FOR LYALL AND WILSON WITH THE CAPABILITIES OF SECHSER AND SAUNDERS !! (I ADDED AN ASTERIX IN THE TABLE UNDER THEIR CAPABILITIES)
Data_Set <- c("Lyall & Wilson (2009)", "Sechser & Saunders (2010)", "Caverley & Sechser (2017)", 
              "Crisher & Souva (2014)", "Saunders & Souva (2019)", "Gannon (2014)")

Start_Year <-  c(min(LWdata$yearbg), min(SSdata$year), min(na.omit(CSdata$year)), min(CrSodata$year), 
                 min(SaSodata$Year), min(na.omit(iiss$year)))

End_Year <-  c(max(LWdata$yearbg), max(SSdata$year), max(na.omit(CSdata$year)), max(CrSodata$year),  
               max(SaSodata$Year), max(na.omit(iiss$year)))

Total_Years <- c((max(LWdata$yearbg)-min(LWdata$yearbg)),(max(SSdata$year)-min(SSdata$year)),
                 (max(na.omit(CSdata$year))-min(na.omit(CSdata$year))),(max(CrSodata$year)-min(CrSodata
                  $year)), (max(SaSodata$Year)-min(SaSodata$Year)),(max(na.omit(iiss$year)) - 
                min(na.omit(iiss$year))))

Countries <- c(length(unique(LWdata$ccode)), length(unique(SSdata$cabb)), length(unique(CSdata$sidea)), length(unique(CrSodata$country)),length(unique(SaSodata$Country)), (length(unique(iiss$country))))

Capabilities <-  c("Mechanized Ground Vehicles*","Mechanized Ground Vehicles*", "Air Force", "Navy", "Air Force", "All")

Replication_Comparison <- data.table(
  Data_Set = Data_Set,
  Start_Year = Start_Year,
  End_Year = End_Year,
  Total_Years = Total_Years,
  Countries = Countries,
  Capabilities = Capabilities
)
```
## Crisher and Souva (navy)

@Natalie - things that should be outputs from the code chunks:
- comparison of coverage (countries, years, teks)
- correlation where identical columns exist
- wrangling either our data or theirs to get some of the other columns to match up. Do correlation there as well

Comparison
For this section, I'd ideally like a table that compares their coverage that looks kind of like the comparison table in paper 1. The 2 rows are the datasets. The columns are start year, end year, total countries as length(unique(df$country))), total country-years, domain of overlap (sea, in this case), number of columns/teks in the domain. To do that right, the code should be generalized so it works for all these datasets. You can do that part last if you want since it's definitely the most work.
```{r}
#LOAD Crisher & Souva data & SUBSET/ARRANGE BY YEAR
CrSodata_sub <- CrSodata %>%
  dplyr::select(year, cowcode,country,
                Battleship, DieselSub, NukeAttSub, BalSub, AircraftCarrier) %>%
  dplyr::arrange(year,) %>%
  dplyr::filter(year >= 1970)

#LOAD IISS data
iiss <- readRDS(file = paste0(here::here(), "/data/01z_rDMC_raw.rds"))

#IISS NAVAL POWER ONLY SUBSET (as defined by Crisher & Souva)
iiss$cs_naval_eq <- NA
iiss$cs_naval_eq <- paste(iiss$equipment_type,iiss$equipment_subtype,iiss$equipment_name)

test <- iiss %>%
  tidyr::unite(tek, c(equipment_type, equipment_subtype, equipment_name), sep = " ", remove = TRUE) %>%
  dplyr::mutate(tek_merge = diesel_sub if tek %in% ())

for (i in (iiss$cs_naval_eq)) {
  division <- iiss$cs_naval_eq == i
  if (i == "submarines attack other") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines attack SS") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines attack SSK") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSK") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines other SSK") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SS") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSG") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA TAC") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines attack SSC") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSC") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSI") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSW") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA ex-SSBN") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA other") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSA") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
   else if (i == "submarines NA SDV") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA TRG") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines TRG TRG") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA UUV") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "submarines NA SSQ") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "diesel_sub")}
  else if (i == "principal surface combatants battleships BB") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "battle_ship")}
  else if (i == "submarines attack SSN") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "nuke_sub")}
  else if (i == "submarines NA SSGN") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "nuke_sub")}
  else if (i == "submarines NA SSB") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "ballistic_sub")}
  else if (i == "submarines NA SSBN") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "ballistic_sub")}
  else if (i == "principal surface combatants aircraft carriers CVN") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants NA CV") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants aircraft carriers CV") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants aircraft carriers CVH") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants aircraft carriers TRG") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants aircraft carriers CVS") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants aircraft carriers CVV") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else if (i == "principal surface combatants aircraft carriers ASW") { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- "aircraft_carrier")}
  else { (iiss$cs_naval_eq[iiss$cs_naval_eq == i] <- NA) }
}

iiss_cs_subset <- iiss[!is.na(iiss$cs_naval_eq),]
iiss_cs_subset <- iiss_cs_subset[!(iiss_cs_subset$year > 2011),]

#IISS SUBSET making categories
iiss_cs_subset$diesel_sub <- NA
iiss_cs_subset$diesel_sub <- ifelse(iiss_cs_subset$cs_naval_eq == "diesel_sub", iiss_cs_subset$unit_count, 0)
iiss_cs_subset$aircraft_carrier  <- NA
iiss_cs_subset$aircraft_carrier  <- ifelse(iiss_cs_subset$cs_naval_eq == "aircraft_carrier",iiss_cs_subset$unit_count, 0)
iiss_cs_subset$nuke_sub  <- NA
iiss_cs_subset$nuke_sub  <- ifelse(iiss_cs_subset$cs_naval_eq == "nuke_sub",iiss_cs_subset$unit_count, 0)
iiss_cs_subset$ballistic_sub  <- NA
iiss_cs_subset$ballistic_sub  <- ifelse(iiss_cs_subset$cs_naval_eq == "ballistic_sub",iiss_cs_subset$unit_count, 0)
iiss_cs_subset$battle_ship  <- NA
iiss_cs_subset$battle_ship  <- ifelse(iiss_cs_subset$cs_naval_eq == "battle_ship",iiss_cs_subset$unit_count, 0)

#IISS SUSBET remove rows which are all NA
iiss_cs_subset <- iiss_cs_subset[!(iiss_cs_subset$diesel_sub == 0 & iiss_cs_subset$aircraft_carrier == 0 &  iiss_cs_subset$nuke_sub == 0 & 
iiss_cs_subset$ballistic_sub == 0 & iiss_cs_subset$battle_ship == 0 ),]


#IISS SUBSET NAVAL POWER FOR COW CODES == CRISER & SOUVA COWCODES 
names(iiss_cs_subset)[names(iiss_cs_subset) == "ccode"] <- "cowcode"
length(unique(iiss_cs_subset$cowcode))
length(unique(CrSodata_sub$cowcode))
intersect(iiss_cs_subset$cowcode,CrSodata_sub$cowcode)
unique(CrSodata_sub$cowcode)
unique(iiss_cs_subset$cowcode)

official_CrS_subset <- CrSodata_sub[(CrSodata_sub$cowcode == 140 | CrSodata_sub$cowcode == 710 | CrSodata_sub$cowcode == 
750 | CrSodata_sub$cowcode == 850 | CrSodata_sub$cowcode == 210 | CrSodata_sub$cowcode == 770 | CrSodata_sub$cowcode == 713 | CrSodata_sub$cowcode ==  2 | CrSodata_sub$cowcode == 900 | CrSodata_sub$cowcode == 290 | CrSodata_sub$cowcode == 651 | CrSodata_sub$cowcode == 365 | CrSodata_sub$cowcode == 339 | CrSodata_sub$cowcode == 355 | CrSodata_sub$cowcode == 235 | CrSodata_sub$cowcode == 20 | CrSodata_sub$cowcode == 155 | CrSodata_sub$cowcode == 100 | CrSodata_sub$cowcode == 230 | CrSodata_sub$cowcode == 560 | CrSodata_sub$cowcode == 666 | CrSodata_sub$cowcode == 135 | CrSodata_sub$cowcode == 101 | CrSodata_sub$cowcode == 350 | CrSodata_sub$cowcode == 255 | CrSodata_sub$cowcode == 620 | CrSodata_sub$cowcode == 640 | CrSodata_sub$cowcode == 220 | CrSodata_sub$cowcode == 380 | CrSodata_sub$cowcode == 40 | CrSodata_sub$cowcode == 390 | CrSodata_sub$cowcode == 325 | CrSodata_sub$cowcode == 740 | CrSodata_sub$cowcode == 385 | CrSodata_sub$cowcode == 200 | CrSodata_sub$cowcode == 345 | CrSodata_sub$cowcode == 615 | CrSodata_sub$cowcode == 160 | CrSodata_sub$cowcode == 732 | CrSodata_sub$cowcode == 652 | CrSodata_sub$cowcode == 731 | CrSodata_sub$cowcode == 360 | CrSodata_sub$cowcode == 130 | CrSodata_sub$cowcode == 630 | CrSodata_sub$cowcode == 344 | CrSodata_sub$cowcode == 800 | CrSodata_sub$cowcode == 369 | CrSodata_sub$cowcode == 830 | CrSodata_sub$cowcode == 816 | CrSodata_sub$cowcode == 820),]

CrSodata_sub$cowcode <- as.character(CrSodata_sub$cowcode)

official_iiss_subset <-  iiss_cs_subset[(iiss_cs_subset$cowcode == 140 | iiss_cs_subset$cowcode == 710 | iiss_cs_subset$cowcode == 
750 | iiss_cs_subset$cowcode == 850 | iiss_cs_subset$cowcode == 210 | iiss_cs_subset$cowcode == 770 | iiss_cs_subset$cowcode == 713 | iiss_cs_subset$cowcode ==  2 | iiss_cs_subset$cowcode == 900 | iiss_cs_subset$cowcode == 290 | iiss_cs_subset$cowcode == 651 | iiss_cs_subset$cowcode == 365 | iiss_cs_subset$cowcode == 339 | iiss_cs_subset$cowcode == 355 | iiss_cs_subset$cowcode == 235 | iiss_cs_subset$cowcode == 20 | iiss_cs_subset$cowcode == 155 | iiss_cs_subset$cowcode == 100 | iiss_cs_subset$cowcode == 230 | iiss_cs_subset$cowcode == 560 | iiss_cs_subset$cowcode == 666 | iiss_cs_subset$cowcode == 135 | iiss_cs_subset$cowcode == 101 | iiss_cs_subset$cowcode == 350 | iiss_cs_subset$cowcode == 255 | iiss_cs_subset$cowcode == 620 | iiss_cs_subset$cowcode == 640 | iiss_cs_subset$cowcode == 220 | iiss_cs_subset$cowcode == 380 | iiss_cs_subset$cowcode == 40 | iiss_cs_subset$cowcode == 390 | iiss_cs_subset$cowcode == 325 | iiss_cs_subset$cowcode == 740 | iiss_cs_subset$cowcode == 385 | iiss_cs_subset$cowcode == 200 | iiss_cs_subset$cowcode == 345 | iiss_cs_subset$cowcode == 615 | iiss_cs_subset$cowcode == 160 | iiss_cs_subset$cowcode == 732 | iiss_cs_subset$cowcode == 652 | iiss_cs_subset$cowcode == 731 | iiss_cs_subset$cowcode == 360 | iiss_cs_subset$cowcode == 130 | iiss_cs_subset$cowcode == 630 | iiss_cs_subset$cowcode == 344 | iiss_cs_subset$cowcode == 800 | iiss_cs_subset$cowcode == 369 | iiss_cs_subset$cowcode == 830 | iiss_cs_subset$cowcode == 816 | iiss_cs_subset$cowcode == 820),]

official_iiss_subset <- official_iiss_subset %>%
  dplyr::select(year, cowcode, country,
                battle_ship,diesel_sub, nuke_sub, ballistic_sub, aircraft_carrier) 

# IISS SUBSET & Crisher & Souva Comparison

library(janitor)
library(dplyr)

joint_CrS_IISS <- full_join(CrSodata_sub, official_iiss_subset,
                            by = c("year" = "year", "cowcode" = "cowcode"),
                            suffix = c("_CrSo", "_rdmc"))

#CORRELATION TEST:
# ** QUESTION ** what type of correlation test - "pearson", "kendall", "spearman"
cor.test(joint_CrS_IISS$Battleship, joint_CrS_IISS$battle_ship, method = c("pearson"))
cor.test(joint_CrS_IISS$DieselSub, joint_CrS_IISS$diesel_sub, method = c("pearson"))
cor.test(joint_CrS_IISS$NukeAttSub, joint_CrS_IISS$nuke_sub, method = c("pearson"))
cor.test(joint_CrS_IISS$BalSub, joint_CrS_IISS$ballistic_sub, method = c("pearson"))
cor.test(joint_CrS_IISS$AircraftCarrier, joint_CrS_IISS$aircraft_carrier, method = c("pearson"))

#CORRELATION TABLE FOR EACH EQUIPMENT CATEGORY: (MADE IDENTIFCAL COLUMNS)



```

Easy correlation where identical columns exist
```{r}
# Merge
compare <- dplyr::full_join(CrSodata_sub, df_sub,
                            by = c("year", "cowcode"),
                            suffix = c("_CrSo", "_rdmc"))

# using ggally (https://ggobi.github.io/ggally/)
compare %>%
  dplyr::select(dplyr::starts_with("AircraftCarrier")) %>%
  GGally::ggpairs()

# using corrmorant (https://github.com/r-link/corrmorant)
compare %>%
  dplyr::select(dplyr::starts_with("AircraftCarrier")) %>%
  corrmorant::corrmorant()
```

More challenging columns where have to wrangle to get them to match
```{r}

```

## Saunders and Souva (airpower)

```{r}
#LOAD Saunders & Souva data & SUBSET/ARRANGE BY YEAR
SaSodata_sub <- SaSodata %>%
  dplyr::select(Year,Country,ccode1,TotalCombatAircraft) %>%
  dplyr::arrange(Year,) %>%
  dplyr::filter(Year >= 1970)

#LOAD IISS data
iiss <- readRDS(file = paste0(here::here(), "/data/01z_rDMC_raw.rds"))

#DATA TABLE:
#comparison of coverage (countries, years, teks)
data_set <- c("Saunders & Souva", "Gannon")
start_year <-  c(min(SaSodata_sub$Year), min(na.omit(iiss$year)))
end_year <-  c(max(SaSodata_sub$Year), max(na.omit(iiss$year)))
total_years <- c(length(unique(SaSodata_sub$Year)),length(unique(iiss$year)))
countries <- c(length(unique(SaSodata_sub$Country)), (length(unique(iiss$country))))
overlap_domain <-  c("Combat Aircraft - Air Power", "All Military Power")
SaSo_IISS_Comparison <- data.table(
  data_set = data_set,
  start_year = start_year,
  end_year = end_year,
  total_years = total_years,
  countries = countries,
  overlap_domain = overlap_domain
)

#IISS AIR POWER ONLY SUBSET (as defined by Crisher & Souva)

#LILY: what designated the Air Power Set: SS writes, "Combat aircraft include fighters, attack planes and some combat support planes such as electronic countermeasure aircraft. Combat aircraft do not include transports, tankers or training aircraft." The appendix is not helpful at clarifying. IISS says "The term 'combat aircraft', as used in the text, comprises bombers, fighter-bombers, interceptors, and reconnaissance, light-strike, counter-insurgency and armed trainer aircraft, but not other categories of military aircraft." Given these two definitions I have included all the underlined categories. However, it could be that SS doesn't count some aircraft that IISS does, so look out for categories that show up as totally superfluous.

#IISS says that training and transport craft are sometimes included in combat aircraft, while SS implies that this is NEVER the case. Therefore, we should start off under the assumption that the following teks are NOT included by SS. However, since these craft are all dual purpose it's ambiguous, and we may have to include these later: aircraft_NA_ATK/TRG aircraft_NA_ATTACK/TRG aircraft_NA_COIN/TRG aircraft_NA_Coin/TRG aircraft_NA_TRG/COIN aircraft_NA_ECM/TRG aircraft_NA_EW/TPT aircraft_NA_ELINT/TPT aircraft_NA_TRG/FTR aircraft_NA_CBT/TRG aircraft_NA_FTR/TRG aircraft_NA_TAC/TRG aircraft_NA_TAC/TPT aircraft_NA_ISR/TKR


iiss$ss_naval_eq <- NA
iiss$ss_naval_eq <- paste(iiss$equipment_type,iiss$equipment_subtype,iiss$equipment_name)

for (i in (iiss$ss_naval_eq)) {
  division <- iiss$ss_naval_eq == i
  if (i == "aircraft NA ATK") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ATK/FGA") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ATK/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA CLOSE SPT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA COIN") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA Coin") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA COIN/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/COIN") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/FTR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/FTR/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/ISR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/OCU") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FGA/SQN") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FB") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA GUNSHIP") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA LT ATK/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA BB") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA BBR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA bombers") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA BBR/FTR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA BBR/FGA") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA BBR/MR/ECM") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA BBR/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA LRSA") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA MD BBR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA SEAD") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ECR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ECM") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ECM/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ELINT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ELINT/ECM") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ELINT/ESM") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA EW") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA EW/FGA") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA AWX") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA CBT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/BBR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/FGA") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/FGA/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/ISR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/OCU") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA interceptor") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA Interceptor") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA INTERCEPTOR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA STRIKE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA strike") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA STRIKE/FGA") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA STK/RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ISR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ISTAR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA OBSERVATION") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA RECCE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA recce") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA RECCEE") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA RECON") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA RECCE/ECM") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA SURV") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA SURV/SIGINT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA TAC") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA TAC/FTR ") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
    else if (i == "aircraft NA ATK/TRG") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ATTACK/TRG") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA COIN/TRG") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA Coin/TRG") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA TRG/COIN") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ECM/TRG") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA EW/TPT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ELINT/TPT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA TRG/FTR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA CBT/TRG ") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA FTR/TRG") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA TAC/TRG ") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA TAC/TPT") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
  else if (i == "aircraft NA ISR/TKR") { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- "combat_aicraft")}
    else { (iiss$ss_naval_eq[iiss$ss_naval_eq == i] <- NA) }
}
  
iiss_ss_subset <- iiss[!is.na(iiss$ss_naval_eq),]
iiss_ss_subset <- iiss_ss_subset[!(iiss_ss_subset$year > 2014),]

#IISS Binary Variable for Hybrid Traing/Combat Vechicles
iiss_ss_subset$hybrid_aircraft <- NA
iiss_ss_subset$hybrid_aircraft <- paste(iiss_ss_subset$ss_naval_eq)

for (i in (iiss_ss_subset$hybrid_aircraft)) {
  division <- iiss_ss_subset$hybrid_aircraft == i
  if  (i == "aircraft NA ATK/TRG") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraf == i] <- 1)}
  else if (i == "aircraft NA ATTACK/TRG") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA COIN/TRG") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA Coin/TRG") { (iiss_ss_subset$thybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA TRG/COIN") { (iiss_ss_subset$thybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA ECM/TRG") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA EW/TPT") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA ELINT/TPT") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA TRG/FTR") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA CBT/TRG ") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA FTR/TRG") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA TAC/TRG ") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA TAC/TPT") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
  else if (i == "aircraft NA ISR/TKR") { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 1)}
    else { (iiss_ss_subset$hybrid_aircraft[iiss_ss_subset$hybrid_aircraft == i] <- 0) }
}

#IISS SUBSET for Total Combat Aircraft Counts
iiss_ss_subset$combat_aircraft <- NA
iiss_ss_subset$combat_aircraft <- ifelse(iiss_ss_subset$cs_naval_eq == "combat_aircraft", iiss_cs_subset$unit_count, 0)


#IISS SUBSET NAVAL POWER FOR COW CODES == SAUNDERS & SOUVA COWCODES 
names(iiss_ss_subset)[names(iiss_ss_subset) == "ccode"] <- "ccode1"
length(unique(iiss_cs_subset$cowcode))
length(unique(SaSodata_sub$cowcode))
intersect(iiss_cs_subset$cowcode,SaSodata_sub$cowcode)
unique(SaSodata_sub$cowcode)
unique(iiss_cs_subset$cowcode)


``{r}

```

# Legacy code
## Lyall and Wilson (2009)
Authors Lyall and Wilson argue that increasing mechanization within state militaries after World War 1 made states less liekly to defeat insurgents. The authors tested this argument with a data set of 286 insurgencies (1800–2005) and a paired comparison of two US Army divisions in Iraq (2003–2004). The authors found that at higher levels of mechanization, along with external support for insurgents and the counterinsurgent’s status as an occupier, are associated with an increased probability of state defeat. Moreover, the authors only found partial support for conventional power and regime-based explanations, and no support for the view that rough terrain favors insurgent success.

Data
```{r}
LWdata <- haven::read_dta(file = paste0(here::here(),'/inst/extdata/Lyall-Wilson_IO_2009/Rage_RepData.dta'))
head(LWdata)
```
The dataset contains `r ncol(LWdata)` variables for `r nrow(LWdata)` insurgencies.

```{r}
names(LWdata)
```
Notable variables describing the insurgencies for the years (1800–2005) are below. The remaining variables in the dataset focus on describing the insurgency, incumbent, and insurgent.

* **war**: war name 
* **yearbg**: year war began
* **yearend**: year war concluded
* **startdate**: date war in began in DD/MM/YYYY format
* **enddate**: date war ended in DD/MM/YYYY format
* **incumb**: incumbent name
* **insurg**: insurgent name

### IISS Variable
The **mech** vaiable uses mechanization values obtained from the International Insitute for Strategic Studie's Military Balance 2007 among many other (details below).

The **mech** variable is supplemented with a battlefield-level indicator, **heli**, which records whether an incumbent deployed ≥25 helicopters during a particular war. Note that the codebook doesn't clarify whether the sources for **mech** were also used for **heli**.

* **mech**: Mechanization level is a scaled index that records the prewar soldier-to-mechanized vehicle ratio in the state's military. The size of the country's military was drawn from the CoW dataset and then divided by the number of mechanized vehicles in the country's arsenal. Data for mechanization values were obtained from numerous resources and specified national histories. These include the International Institute for Strategic Studies’ Military Balance 2007; the Stock- holm International Peace Research Institute’s Arms Transfer Database 2007; Jane’s Armor and Artil- lery 2007; Ness 2002; and Solyakin 2005. To avoid endogeneity with war dynamic, both observations are lagged a year prior to the conflict. These values were then collapsed into a four-fold variable with cutpoints at 25% quartiles:
      + 1 represent the lowest level of mechanization (>834 soldiers per vehicle)
      + 2 (288-833 per vehicle)
      + 3 (109-287 per vehicle)
      + 4 represents the highest level (11 - 108 soliders per vehicle)
      
Missing Data
```{r}
fullmech <-subset(LWdata, !is.na(LWdata$mech))
missingmech<-subset(LWdata, is.na(LWdata$mech))
```

There are `r nrow(fullmech)` observations for **mech** for years `r min(fullmech$yearbg)` - `r max(fullmech$yearend)`. The `r nrow(missingmech)` observations that are missing a **mech** value are listed below. 

```{r}
missingmech$war
```

Summary
```{r}
summary(fullmech$mech)

plot(fullmech$mech ~ fullmech$yearbg, xlab="Year War Began",ylab="Mechanization Level",pch=1)
title("Mechanization Level by Year War Began") 

mechtable <-table(fullmech$mech)

barplot(mechtable, main="Mechanization Level Distribution",
  xlab="Mechanization Level")


```

      
### Dependent Variable
The dependent variable is **wdl**, a three-fold variable (Win, Draw, Loss) that indicates the war outcomes.

* A *win*, coded as 2, occurs when the insurgency is militarily defeated and its organization destroyed or the war ends without any political consessions granted to insurgent forces.
* A *draw*, coded as 1, occurs when an incumbent is forced to concede to some, but not all, insurgent demands, and neither side obtains its maximal aims. 
* A *loss*, coded as 0, occurs when the incumbent unilaterally concedes to all, or nearly all, insurgent demands, inclduing the granting of independence or the desposition of the current leaders.

### Independent Variables

* **modern**: Captures whether an incumbent's military was organized around foraging or machine war practices. 
* **railway**: Denotes whether an incumbent used railways to supplemnt its foraging practices during 1817-1917
    + 1 denotes that railways were used; a 0 indicates that railways were not used
* **mech**: Mechanization level is a scaled index that records the prewar soldier-to-mechanized vehicle ratio in the state's military. The size of the country's military was drawn from the CoW dataset and then divided by the number of mechanized vehicles in the country's arsenal. Data for mechanization values were obtained from numerous resources and specified national histories. These include the International Institute for Strategic Studies’ Military Balance 2007; the Stock- holm International Peace Research Institute’s Arms Transfer Database 2007; Jane’s Armor and Artil- lery 2007; Ness 2002; and Solyakin 2005. To avoid endogeneity with war dynamic, both observations are lagged a year prior to the conflict. These values were then collapsed into a four-fold variable with cutpoints at 25% quartiles:
      + 1 represent the lowest level of mechanization (>834 soldiers per vehicle)
      + 2 (288-833 per vehicle)
      + 3 (109-287 per vehicle)
      + 4 represents the highest level (11 - 108 soliders per vehicle)
* **vec**: The estimated number of vehicles that a military possessed in the year prior to the war's outbreak. This number includes main battle tanks, medium battle tanks (1917-45 only), armored personal carriers (APCs), armored fighting vehicles (AFVs), scout cars, and self-propelled artillery in each country's arsenal. The number of trucks within a state's arsenal is not recorded.
* **milper**: The estimated number of personnnel in a state's military (in thousands). These data are drawn almost exclusively from the CoW and are measured in the year prior to the war's outbreak.
* **heli**: Records whether an incumbent deployed ≥25 helicopters during a particular war.
* **regime**: Each country's regime is coded using Polity2 values from the PolityIV dataset. Values are lagged one year prior to conflict (1800 - 2005)
    + Polity2 is a 21-point scaled composite index of regime type that ranges from highly autocratic (-10) to highlly democratic (+10).
* **trade**: The natural log of a country's share of GDP that is derived from imports and exports. Measures are taken in the year prior to the war.
* **support**: A scaled variable that measures whether insurgents received two critical types of assistance: material economic and military aid, and the ability to use a neighboring country as a sanctuary (with out without the permission of the neighboring state)
    + 2 is noted if the insurgent group received both aid and sanctuary
    + 1 is noted if only 1 type was granted
    + 0 is noted if neither aid or sanctuary was received 
* **rear**: Is an individual component of **support**. It is is a binary variable that denotes whether an insurgent organization possessed a sanctuary neighboring state.
    + 1 is noted if insurgents possessed external sanctuary
* **ipatron**: Is an invidual component of **support**. It is a binary variable that records whether the insurgency received material support from a third-party state.
    + 1 is noted if insurgents had an external state patron
* **power**: A country's share of global military (army size, military spending) and economic (iron production, energy consumption, and population) power as recorded by the CoW's Composite Index of National Capabilities variables. Measures are taken in the year prior to the war.
* **gp**: Following the CoW, this binary variable records whether an incumbent was considerent a Great Power in the year prior to the war. This measure acts as an alternative indicator for **power**.
* **energy**: A state's per capita energy consumption, as coded by the CoW measures. Measures are taken one year prior to the war onset.
* **occupy**: Denotes whether a state was an external occupier. A country is coded as an external occupier if its military forces crossed an internationally-recognized border in order to supress an insurgency. 
    + 1 denotes a state was an external occupier; a 0 indicates the state was not an external occupier
    
###Control Variables
* **elevation**: The average of five altitude measures (in meters, logged) taken at the four corners and center of a subnational conflict area (the area in which the preponderance of fighting occurred) or the entire country if conflict was pervasive throughout. 
    + Wars that are primarly fought in or near a capital city are assigned a nominal one kilomenter in distance (1800-2005)
* **distance**: Distance in kilometers (logged) from the state's capital city to the conflict area.
* **language**: Drawing on Fearon and Laitin 2003, this variable records the number of languages spoken by greater than one percent of a population within the subnational conflict zone or the entire country of conflict was pervasive throughout.
* **cold war**: A dummy variable that denotes that 1949-1989 era as the Cold War.

###Variables Used In Robustness Checks
* The dummy variables below denote whether the war occurred in one of 8 10 year intervals below. Decades were begun in 1917. A variable for decade 9 (1997-2006) was not created as the data ends in 2005.
    + **decade1**: 1917-26
    + **decade2**: 1927-36
    + **decade3**: 1937-46
    + **decade4**: 1947-56
    + **decade5**: 1956-66
    + **decade6**: 1967-76
    + **decade7**: 1977-86
    + **decade8**: 1987-96
* **post-1945**: a dummy variable denoting whether the war occurred after 1945 or before
    + 1 denotes after 1945
    + 0 denotes before 1945
* **post-1989**: a dummy variable denoting whether the war occurred after 1989 or before 
    + 1 denotes after 1989
    + 0 denotes before 1989
* **above**: a dummy variable that denotes whether a state with more than one observation possessed a mean **mdl** score signficantly above the mean **mdl** value for all states (1.26). *Significantly* is defined as .5 standard deviations above the mean **mdl**.
* **below**: a dummy variable that denotes whether a state with more than one observation possesed a mean **mdl** score signficiantly below the mean **mdl** value for all states (1.26). *Significantly* is defined as .5 standard deviations below the mean **mdl**.
* **ww2**: a dummy variable that denotes whether the state was Germany or Japan during WW2 or not
    + 1 denotes yes
    + 0 denotes no
* **uk**: a dummary variable that de notes whether the state involved in the war was United Kingdom or not
    + 1 denotes yes
    + 0 denotes no
* **region**: This variables denotes where a conflict occured using the six different regions below.
    + *w. europe*: Western Europe
    + *e. europe*: Eastern Europe
    + *l. america*: Latin America
    + *ssafrica*: Sub-Saharan Africa
    + *asia*: Asia
    + *nafrme*: North Africa and the Middle East
    + *n. america*: North America
* Following Fearon and Laitin 2003, the dummy variables below were used to denote whether a conflict occured in one of six different regions to control for the possibility that outcomes cluster in particular regions
    + **weurope**: Western Europe
    + **eeurop**: Eastern Europe
    + **lamerica**: Latin America
    + **ssafrica**: Sub-Saharan Africa
    + **asia**: Asia
    + **nafrme**: North Africa and the Middle East
    + **namerica**: North America
* **nwstate**: Following Fearon and Laitin 2003, the models were re-estimated with this dummy variable denoting whether war onset occurred during the first two years of a new state’s post-colonial existence.

###Identifier Variables
* **ccode**: lists the COW identifying number for the incumbent (post 1917 armies are coded as 1;otherwise, a 0)
* **yearbg**: year war began
* **yearend**: year war concluded

The insurgencies have been cross-referenced with four existing datasets. A 1 in the respective column denotes that the insurgency is included in the dataset; a 0 signifies it is not.

* **prio**: captures whether an insurgency is included in PRIO-Uppsala’s Armed Conflict Dataset (Version 3)
* **cow**: captures whether an insurgency is included in the CoW Intra-State Dataset (Version 3.0)
* **fl**: captures whether an insurgency is included in Fearon and Laitin 2003
* **pitf**: captures whether an insurgency is included in the Political Instability Task Force’s (PITF) Internal Wars dataset
* **none**: signifies the insurgency is not included in any of the existing datasets above.

###Missing Data
There are `r sum(is.na(LWdata))` *NaN* values in the dataset. 


### Code for Statistical Models
Rage_Rep.do
```{r eval=FALSE}
version 10
capture log close

/* Replication commands for "Rage Against the Machines: Explaining Outcomes in Counterinsurgency Wars (IO 2009)"*/
/* Jason Lyall */
/* January 2009*/

clear
use "C:\Users\jlyall\Documents\Published\Rage Against the Machines\Rage_RepData.dta"
  
ologit wdl modern, cluster(ccode)
ologit wdl modern  support power lelev ldis regime lenerpc coldwar occ, cluster(ccode)
ologit wdl railway support power lelev ldis regime lenerpc occ if modern==0, cluster(ccode)
ologit wdl support power lelev ldis regime lenerpc coldwar occ if modern==1, cluster(ccode)
ologit wdl mech, cluster(ccode)
ologit wdl mech regime occ lenerpc support lelev ldis power, cluster(ccode)
ologit wdl mech regime occ lenerpc support lelev ldis power  ltradegdp numlang, cluster(ccode)
ologit wdl  heli regime occ lenerpc support lelev ldis power ltradegdp numlang, cluster(ccode)
ologit wdl  modern regime occ lenerpc support lelev ldis power coldwar above below, ro
ologit wdl mech regime occ lenerpc support lelev ldis power coldwar above below, ro
ologit wdl  modern regime occ lenerpc support lelev ldis power coldwar  eeurop lamerica   ssafrica asia nafrme namerica, ro
ologit wdl mech regime occ lenerpc support lelev ldis power coldwar eeurop lamerica  ssafrica asia nafrme namerica, ro
ologit wdl mech support power lelev ldis regime lenerpc coldwar occ nwstate, cluster(ccode)
ologit wdl heli support power lelev ldis regime lenerpc coldwar occ nwstate, cluster(ccode)

log close
exit
```

Rage_Rep_Supplemental.do
```{r eval=FALSE}
version 10
capture log close

/* Replication commands for "Rage Against the Machines" (IO 2009): Supplemental Analyses*/
/* Jason Lyall */
/* January 2009*/

clear
use  "C:\Users\jlyall\Documents\Published\Rage Against the Machines\Rage_RepData.dta"  

ologit wdl mech decade2 decade3 decade4 decade5 decade6 decade7 decade8, cluster(ccode)
ologit wdl mech regime occ lenerpc support ldis lelev power decade2 decade3 decade4 decade5 decade6 decade7 decade8, cluster(ccode)
ologit wdl regime occ lenerpc support ldis lelev power decade2 decade3 decade4 decade5 decade6 decade7 decade8, cluster(ccode)
ologit wdl heli decade5 decade6 decade7 decade8, cluster(ccode)
ologit wdl heli regime occ lenerpc support ldis lelev power decade5 decade6 decade7 decade8, cluster(ccode)
ologit wdl regime occ lenerpc support ldis lelev power decade5 decade6 decade7 decade8, cluster(ccode)
ologit wdl mech regime occ lenerpc support ldis lelev power post1945, cluster(ccode)
ologit wdl  heli regime occ lenerpc support ldis power lelev post1945 , cluster(ccode)
ologit wdl mech regime occ lenerpc support ldis lelev power post1989, cluster(ccode)
ologit wdl  heli regime occ lenerpc support ldis power lelev post1989 , cluster(ccode)
ologit wdl modern support power lelev ldis regime lenerpc coldwar occ if ww2!=1, cluster(ccode)
ologit wdl mech support power lelev ldis regime lenerpc coldwar occ if ww2!=1, cluster(ccode)
ologit wdl modern support power lelev ldis regime lenerpc coldwar occ uk, cluster(ccode)
ologit wdl mech support power lelev ldis regime lenerpc coldwar occ uk, cluster(ccode)
logit win modern regime occ ldis lelev support power lenerpc coldwar, cluster(ccode)
logit win railway regime occ ldis lelev support power lenerpc coldwar, cluster(ccode)
logit win mech regime occ ldis lelev support power lenerpc coldwar, cluster(ccode)
logit win heli regime occ ldis lelev support power lenerpc coldwar numlang ltradegdp, cluster(ccode)
logit defeat modern regime occ ldis lelev support power lenerpc coldwar, cluster(ccode)
logit defeat railway regime occ ldis lelev support power lenerpc coldwar, cluster(ccode)
logit defeat mech regime occ ldis lelev support power lenerpc coldwar, cluster(ccode)
logit defeat heli regime occ ldis lelev support power lenerpc coldwar numlang ltradegdp, cluster(ccode)

log close
exit
```

## Sechser Saunders (2010)
This paper tests several hypotheses about the determinants of military mechanization. One perspective suggests that strategic factors, including the force structures of adversaries and neighbors, recent combat lessons, and internal insurgency threats—shape a military’s mix of manpower and vehicles. A second set of hypotheses points instead to domestic institutions such as democracy and civilian control of the military. Still other theories emphasize economic forces and international norms. To test these and other hypotheses, Sechser and Saunders constructed a new data set containing mechanization rates for more than 150 militaries from 1979 to 2001. Broadly, they found significant support for the strategic perspective and little support for domestic institutional explanations. In addition, the results suggest systematic and predictable differences in the ways states structure their militaries in response to security pressures.

### Hypotheses
The following hypotheses concern external and internal threats:

* **Hypothesis 1:** States that face highly mechanized adversaries will have more mechanized
militaries, on average, than states facing less-mechanized adversaries.
* **Hypothesis 2:** States with highly mechanized neighbors will have more mechanized militaries, on average, than states with less-mechanized neighbors.
* **Hypothesis 3:** States with mountainous terrain will have less-mechanized militaries, on
average, than states with flat terrain

The following hypotheses are about the influence of battlefield experiences on military mechanization:

* **Hypothesis 4:** States that have recently experienced failure in counterinsurgency wars will have lower mechanization levels, on average, than states that have not. 
* **Hypothesis 5:** States that have recently experienced failure in conventional wars will have higher mechanization levels, on average, than states that have not. 
* **Hypothesis 6:** States experiencing counterinsurgency failure within their own borders will have lower mechanization levels, on average, than states experiencing counterinsurgency failure in external interventions.

The following hypotheses are about institutional factors:

* **Hypothesis 7:** Democratic states will have higher mechanization levels, on average, than nondemocratic states. 
* **Hypothesis 8:** States with military governments will have higher mechanization levels, on average, than those with civilian governments. 
* **Hypothesis 9:** States experiencing internal instability will have higher mechanization levels, on average, than states with stable domestic institutions.

Data
```{r}
SSdata <- readtext::readtext(file = paste0(here::here(),'/inst/extdata/Sechser-Saunders_ISQ_2010/sechser-saunders-ISQ-2010.tab'))
head(SSdata)
```

The data set includes `r ncol(SSdata)` variables for `r nrow(SSdata)` militaries from  `r min(SSdata$year)` - `r max(SSdata$year)`. 

Variables
### IISS Variable
The paper uses data on military arsenals and force levels provided by The Military Balance, a series of annual reports published by the International Institute for Strategic Studies,
to construct a National Mechanization Index - **mech**. 

**mech** reports the number of armored vehicles per 100 soldiers of 173 unique states for all odd-numbered years between 1979 and 2001.There are thus only 12 temporal periods contained in the data set.To mitigate the possibility that ‘‘microstates’’ such as Grenada, Brunei, and the Bahamas might skew inferences drawn from the data, states with a population of less than 750,000 are not included in the data set, leaving 153 states in the data set that the authors evaluate. Overall, the data exhibit a clear upward trend in mechanization over time.

The National Mechanization Index measures the degree to which militaries employ motorized armored vehicles, which enhance mobility and force protection but can also isolate soldiers from contact with local populations. Three broad classes of vehicles are included in the count of armored vehicles used to construct **mech**:

* **Main Battle Tanks**:The Military Balance defines a main battle tank as an armored, tracked combat vehicle with a minimum weight of 16.5 metric tons and a 360 traverse gun whose caliber
is at least 75 mm. Examples include the American M-1 Abrams, the Soviet T-80, and the Chinese Type-59 tank.
* **Heavy Armored Combat Vehicle**: Defined as an armored vehicle weighing at least 6
metric tons and containing an organic direct-fire weapon of at least 75 mm. Examples include light tanks such as China’s amphibious Type-63 and Taiwan’s M-41, as well as armored reconnaissance vehicles such as the Israeli RBY and the British-built Ferret.
* **Armored Personnel Carriers and Infantry Fighting Vehicles:** These vehicles are designed to
transport infantry squads and are armed with organic cannons of at least 20 mm. Examples include tracked vehicles such as the Bradley Fighting Vehicle and the Soviet-built BMP systems as well as wheeled vehicles like the Chinese WZ551.20.

**mech** contains only ground vehicles (including amphibious variants) and counts only army, naval infantry, and marine troops, reflecting the fact that the foregoing propositions relate primarily to the mechanization of land armies. To remain faithful to the papers' hypotheses, it is important to avoid the possibility that the presence of air and naval branches in some states might skew mechanization scores. Thus most naval personnel (except for marines and naval infantry) and all air force personnel are excluded from the tally of troops, as well as equipment in these branches.

How is the index constructed?
 Each index entry is constructed by first dividing each state’s total number of vehicles in a given year by the sum of its army, marine, and naval infantry forces. 
 
Lagged Dependent Variable
**log_mech_lag2**: The dataset includes a lagged value of **log_mech**, which has important consequences for the interpretation of the model. While the lagged dependent variable has advantageous properties for model estimation, there are theoretical reasons to include it in this model as well. Achen (2000) discusses the importance of using theory to guide the inclusion of lagged dependent variables. There is likely to be natural persistence in the data, especially for states hoping to expand their military vehicle inventories—it can take years for vehicle production orders to trickle into operational stockpiles. Of even greater theoretical importance, however, are bureaucratic, cultural, and other factors that can generate continuity in defense policy over time. A lagged dependent variable can capture this inertia explicitly. For an example of a similar approach in the context of foreign aid policy, see Carey (2007:454). It should be noted that given the effective number of years in the data set and the inclusion of the lag, much of the variation captured by the regressions is cross-sectional.
 
Identifier Columns
* **year**: Year corresponding to the count of armored vehicleby from the The Military Balance, a series of annual reports published by the International Institute for Strategic Studies.
* **cab**: Country Abbreviation
* **cname**: Country Name

Note that Lyall and Wilson use similar dummy variables as below.
* **namerica**: Dummy variable indicating if the country is in North America
* **samerica**: Dummy variable indicating if the country is in South America
* **europe**: Dummy variable indicating if the country is in Europe
* **ssafrica**: Dummy variable indicating if the country is in Sub Saharan Africa
* **nafmideast**: Dummy variable indicating if the country is in the Middle East
* **asia**: Dummy variable indicating if the country is in Asia

Independent Variables
Most independent variables are lagged by two years (that is, one period) to rule out the possibility of reverse causality. In the regressions most independent variables are also logged to minimize the effect of outliers and to account for the likely declining marginal effects of the independent variables.

Strategic Threats
Five variables account for the influence of strategic pressures on choices about military force structure and mechanization. To remain as faithful as possible to the hypotheses concerning enemies, neighbors, and allies, the variables reflect both the material power and force structure of these states.

* **log_mech_enemies**: This variable is the logged annual average mechanization score for a state’s adversaries, testing the proposition that states respond to security pressures by mimicking the force structures of their enemies (Hypothesis 1). The formula for calculating MECH ENEMIES in a given year is located in pg. 496.
    + An enemy is defined as a state with whom a country has engaged in at least one militarized interstate dispute (MID) during the preceding ten years, irrespective of who initiated the dispute.Data regarding MID participation are drawn from version 2.0 of Maoz’s (2003) Dyadic Militarized Interstate Disputes data set and version 3.1 of the Correlates of War Project’s Militarized Interstate Disputes data set (Ghosn, Palmer, and Bremer 2004).
    + Each adversary’s contribution to the annual average is weighted by the frequency of MIDs within the dyad during the preceding 10 years as well as each its Composite Indicator of National Capabilities (CINC) score (Singer, Bremer, and Stuckey 1972). The CINC index includes military personnel, military expenditures, iron and steel production, energy consumption, and both urban and overall population in its calculated scores
* **log_mech_neighbors**: represents a logged weighted average of the mechanization scores of a state’s contiguous neighbors. Since the vast majority of interstate conflicts occur between geographic neighbors (Bremer 1992), states must pay especially close attention to the structure and doctrine of nearby military forces (Hypothesis 2). Data on state contiguity are drawn from the Correlates of War Project’s Direct Contiguity data (Stinnett, Tir, Schafer, Diehl, and Gochman 2002).
    + In constructing this variable, each neighbor’s mechanization rate is weighted according to its CINC score using a calculation similar to that for **log_mech_enemies**. Both of these variables are in fact interaction terms that take on positive values only when at least one of the relevant dyad partners (that is, enemies or neighbors) exists. This coding is achieved by interacting the calculated averages with the dummy indicators **enemies_dummy** and **neighbors_dummy**, which indicate whether states had at least one recent enemy or contiguous neighbor. The interaction step is necessary to ensure that the coefficients associated with **log_mech_enemies**and **log_mech_neighbors** are interpreted correctly, since the values for these coefficients are relevant only when a state has at least one of these respective partners.
* **log_mountainous**: To test the proposition that states with especially rough terrain might maintain less-mechanized militaries to guard against insurgencies (Hypothesis 3), the dataset includes Fearon and Laitin’s (2003) logged estimates of the percentage of mountainous terrain within a state.
* **antimech_lesson_2, antimech_lesson_4, antimech_lesson_6, antimech_lesson_8, antimech_lesson_10**: These variables examine the influence of recent battlefield experiences—especially failures. Cases in which states experienced a loss or a draw against an insurgency qualify as anti-mechanization lessons. The data includes counterinsurgencies fought both at home and abroad, but instances in which a state sent aid to an incumbent to fight against an insurgency but did not confront the insurgency directly are excluded.
    + For each counterinsurgency that ultimately resulted in a loss or a draw for the incumbent state, a dummy variable ANTIMECH LESSON is assigned the value of 1 during each year in which the state participated in the counterinsurgency, as well as the two years following the end of the conflict. These procedures are designed to accommodate two possibilities: first, that a poor performance in wartime may inspire adaptation even before the conflict ends; and second, that lessons learned on the battlefield may persist beyond the end of the war. In other words, ANTIMECH LESSON is coded 1 if, during the preceding two years, a state participated in a counterinsurgency that ultimately ended in a loss or a draw. The variable is also coded 1 if the state experienced a takeover by a successful insurgency during the preceding two years, and 0 otherwise.
    + The authors integrated data on state participation in counterinsurgency conflicts from Lyall and Wilson (2009) to determine whether states that have experienced failed campaigns against less-mechanized guerrilla or insurgent forces have lower mechanization levels (Hypothesis 4). These events are referred to as ‘‘anti-mechanization lessons,’’ reflecting the finding that lower mechanization rates appear to be more appropriate for fighting against insurgents. But it is important to note that no judgment is made about whether (or how) states ought to adapt to wartime failures; as the authors are interested only in the empirical question of whether states actually appear to do so. In addition, this variable can only determine whether states adjust their mechanization rates in ways that are consistent with this hypothesis, but it contains no direct information about the process causing the adjustment.
* **promech_lesson_2, promech_lesson_4, promech_lesson_6, promech_lesson_8, promech_lesson_10**: these variables address the corollary hypothesis: that states might respond to losses on conventional battlefields by increasing the proportion of vehicles in their land forces (Hypothesis 5). Just as defeat at the hands of a guerrilla army might persuade leaders to more closely mimic the less-mechanized force structure of their foe, a loss to a conventional enemy might convince leaders of the need for greater mechanization. 
    + Using data from Gleditsch (2004), a dummy variable indicates whether a state has fought in a losing conventional war during the preceding two years.
    
Domestic Institutions
An indicator for democratic regimes (Hypothesis 7) is derived from data collected by the Polity IV project (Marshall and Jaggers 2007). The Polity project provides composite indicators of democracy and autocracy on 11-point scales (0– 10); as has become customary in the field, the authors add 11 points to the democracy score and subtract the autocracy score from it to obtain an overall regime type indicator on a scale of 1 to 21, with 21 being the democratic extreme of the spectrum. 

* **democracy**: a dummy variable that denote states whose overall regime score is greater than 14. Following Fearon and Laitin (2003)
* **instability**: a dummy variable that denotes whether the state’s Polity IV score was more than two points different from its score two years prior (Hypothesis 9). To denote instability, Fearon and Laitin (2003) require a 3-point change in Polity score during the preceding three years. The author's measure is therefore both more and less restrictive—the change required is smaller, but the window under consideration is also narrower.
* **military_govt**: A dummy variable denoting national military rule. This third institutional variable is designed to test associations between force structure and the political power of the military (Hypothesis 8). Arthur Banks’(2002) Cross-National Time Series data set identifies countries whose heads of state are also active military officers (for example, Pakistan under General Pervez Musharraf). 

Economic Factors

* **log_gdp_cap**: To test the hypothesis that national capital-labor ratios affect the ability to generate capital-intensive, mechanized armies, the authors incorporate data on real GDP per capita, which Gartzke (2001:475) (wooho - shout out!) argues is a reflection of the capital-labor ratio in the economy. 
    + This variable has the advantage of accounting for both industrial and human factors of production: other things being equal, large stocks of capital suitable for the purchase or production of mechanized weapons will be associated with a higher GDP per capita, whereas large pools of potential military manpower (that is, large populations) will correspond to a lower GDP per capita. 
    + The authors employ data drawn from version 6.2 of the Penn World Table (Heston, Summers, and Aten 2006) regarding real per-capita GDP (in constant 2,000 dollars) and compute the logarithm to generate the variable. T
* **iron_steel**: To account for the ability of states to produce the raw materials necessary for mechanized armies, the authors draw from Singer et al.’s (1972) national material capabilities data to create this variable, which measures states’ annual iron and steel production in billions of tons.

Alliances

*  **log_mech_allies**: Accounting for the influence of alliances on military force structure requires a measurement of the (logged) mechanization rates of allies, defined as states with whom a country has a formal defense treaty. Data on alliances was obtained from Leeds, Ritter, Mitchell, and Long (2002).
* **allies_dummy**: Like **log_mech_enemies** and **log_mech_neighbors**, this variable is weighted by CINC scores and is paired with the dummy variable that is given the value of 1 for states that have at least one formal ally. 
* **cold_war_bloc**: To identify any unique effects of membership in the world’s rival alliance systems during the Cold War, this dummy variable indicates whether a state was a member of either NATO or the Warsaw Pact during the year in question.

International Norms

* **igos**: This variable is a simple count of a state’s IGO membership in a given year. Data is drawn from Thethe updated version of Wallace and Singer’s (1970) International Governmental Organization data set.
    + The hypothesis that state behavior is influenced by international norms also suggests that international institutions transmit those norms. A common indicator of a state’s ‘‘connectedness’’ to the international community, which we adopt here, is the number of intergovernmental organizations (IGOs) in which the state possesses full and active membership (for example, Eyre and Suchman 1996).
    
Former Soviet Republics

* **post_soviet**: A dummy variable to denote states that were once part of the Soviet Union, allowing a test of the hypothesis that the collapse of the Soviet Union left these states with artificially large stockpiles of tanks and vehicles

### Descriptive Statistics
```{r}
summary(SSdata$mech)
summary(SSdata$year)
plot(SSdata$mech ~ SSdata$year, xlab="Year",ylab="Mechanization Level")
title("Mechanization Level by Year") 

alliestable <- table(SSdata$allies_dummy)
barplot(alliestable, main="Count of Countries with Allies in the Dataset",
  xlab="Allies (0=No Ally; 1=At least 1 Ally)", col=c("darkblue","red"), beside=TRUE)

alliessub<-subset(SSdata, SSdata$allies_dummy==1)
noallies<-subset(SSdata, SSdata$allies_dummy!=1)
plot(alliessub$mech ~ alliessub$year, col="blue", xlab="Year",ylab="Mechanization Level", pch=20)
points(noallies$mech ~ noallies$year, col="red", pch=20)
legend("topleft", legend= c("Allies", "No Allies"), col = c("blue","red"),pch = c(20,20))
```

### Codes for Statistical Models
In the regressions below (Figures 1, 2, and 3 (pp. 493-95)), the dependent variable, **log mech**, uses the natural logarithm of the index values to normalize the distribution and mitigate the influence of outlying values. The logged value also reflects what the authors expect to be a non-linear relationship between mechanization and the independent variables. At low initial levels of mechanization, the independent variables should have a larger impact, with declining marginal effects as mechanization increases. All other variables involving mechanization (such as the mechanization level of adversaries) are also logged.


```{r eval=FALSE}
******************************************************************************
*                                                                            *
* Todd S. Sechser and Elizabeth N. Saunders                                  *
* "The Army You Have: The Determinants of Military Mechanization, 1979-2001" *
* International Studies Quarterly 54:4 (2010): 481-511                       *
*                                                                            *
******************************************************************************

* Purpose
* This is a Stata replication file for "The Army You Have."  It reproduces Figures 1, 2, and 3 (pp. 493-95).
*
* Data
* Replication data and this command file can be downloaded from http://dvn.iq.harvard.edu/dvn/dv/isq.
* 
* Requirements
* The original article used Intercooled Stata 10.1 to generate these figures.


use sechser-saunders-ISQ-2010.dta, clear
set output e
set more off

*Figure 1 (p. 493)

gen meanworld = .
gen meannamerica = .
gen meansamerica = .
gen meanasia = .
gen meaneurope = .
gen meanssafrica = .
gen meannafmideast = .

local counter = 1979
while `counter' <= 2001 {

sum mech if population >750 & year == `counter'
replace meanworld = r(mean) if year == `counter' & ccode ~=225

sum mech if population >750 & year == `counter' & namerica == 1
replace meannamerica = r(mean) if year == `counter'

sum mech if population >750 & year == `counter' & samerica == 1
replace meansamerica = r(mean) if year == `counter'

sum mech if population >750 & year == `counter' & europe == 1 & ccode ~=225
replace meaneurope = r(mean) if year == `counter'

sum mech if population >750 & year == `counter' & asia == 1
replace meanasia = r(mean) if year == `counter'

sum mech if population >750 & year == `counter' & ssafrica == 1
replace meanssafrica = r(mean) if year == `counter'

sum mech if population >750 & year == `counter' & nafmideast == 1
replace meannafmideast = r(mean) if year == `counter'

local counter = `counter' + 2
}

sort year

twoway (line meanworld year)  (line meaneurope year) (line meansamerica year) if ccode ==2, ytitle("Mechanization rate (vehicles per soldier)",size(vsmall)) ylabel(,labsize(vsmall)) xtitle("") xlabel(,labsize(vsmall)) legend(order(1 "World" 2 "Europe" 3 "South America") size(vsmall) position(12))

drop meanworld-meannafmideast

set more on
set output p
di "Press any key to continue to Figure 2."
more
set output e
set more off

*Figure 2 (p. 494)

graph box mech if population>750, over(year, gap(50) label(labsize(vsmall))) box(1, lwidth(none)) outergap(0) lintensity(0) alsize(50) cwhisker lines(lcolor(black) lwidth(vvvthin)) marker(1, msize(vsmall) msymbol(circle) mlabel(cabb) mlabsize(tiny)) ytitle("Mechanization rate (vehicles per soldier)", size(vsmall)) ylabel(, labsize(vsmall)) xsize(3) ysize(3.5)

set more on
set output p
di "Press any key to continue to Figure 3."
more
set output e
set more off


*Figure 3 (p. 495)

drop if mech==.
drop if population < 750
sort year mech

gen rank_mech = 1
local counter = 1
while `counter' <= 200 {
replace rank_mech = `counter'+1 if year == year[_n-`counter']
local counter = `counter' + 1
}

gen maxrank = rank_mech
local counter = 1
while `counter'<= 200 {
replace maxrank = rank_mech[_n+`counter'] if year == year[_n+`counter']
local counter = `counter' + 1
}
gen pctile = rank_mech/maxrank
replace pctile = 1 - pctile

gen maxmech = mech
local counter = 1
while `counter'<= 200 {
replace maxmech = mech[_n+`counter'] if year == year[_n+`counter']
local counter = `counter' + 1
}
gen mechpctile = mech/maxmech

sort pctile

save figure3, replace

twoway (scatter mechpctile pctile if year == 1979 & pctile>=0, mcolor(black) msize(vsmall) msymbol(circle)) (scatter mechpctile pctile if year == 2001 & pctile>=0, mcolor(black) msize(small) msymbol(circle_hollow)), ytitle("Mechanization, as Percent of Yearly Maximum", size(vsmall)) xtitle("Percent of States with a Higher Mechanization Score", size(vsmall)) xlabel(0(.2)1, labsize(vsmall)) ylabel(.2(.2)1, labsize(vsmall)) legend(label(1 "1979") label(2 "2001") position(12) rows(2) size(vsmall))

drop rank_mech maxrank pctile maxmech mechpctile
```
